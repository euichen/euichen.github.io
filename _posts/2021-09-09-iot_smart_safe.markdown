---
layout: post
title: 간단한서버를 활용한 사물인터넷을 이용한 스마트 금고
image: safe.gif
date: 2020-09-09 13:35:20 +0200
tags: [라즈베리파이, Flask, AWS, 파이썬, 리눅스, 하드웨어]
categories: AWS
---

개발 의도 : 간단한 서버를 구성하고 이를 이용해 스마트 금고를 만들자
<br><br><br><br>

+ ## 재료

T-Cobbler Plus V2.0, HC-SR04(초음파 거리센서), 푸시 버튼(입력오타방지정책 - 색LED), LED 기타등등
<br><br><br><br>

# 제작 과정

+ ## 과제 계획 및 예상 과제 개발 성과
    + 사물인터넷을 통한 금고 보안 기술 향상	
	+ 다양한 환경에서 사용가능한 시스템 개발(금고, 위험구역, 보안구역 등 )
	+ T초음파 센서 and 버튼을 이용한 비밀번호 입력 장치의 보안 강도 강화
	+ 실시간 서버 시스템 개발
	+ 서버를 통한 접근 기록 전송 및 저장
    
![]({{site.baseurl}}/images/smart_safe/work.PNG)



<br><br><br><br>

+ ## 각종 센서, 도구 사용법
    + T-Cobbler Plus V2.0
        + GPIO EXTENSION BOARD는 라즈베리파이의 GPIO 핀을 길게 확장시켜주어 선 연결을 편리하게 해주는 제품이다.
        보통 라즈베리파이의 GPIO 기능을 이용하려면, 여러개의 전선들을 연결하다 보니전선들끼리 부딪혀 잘 연결되지 않거나 헐거워져서 빠지는 경우가 발생한다.
        하지만 GPIO EXTENSION BOARD를 사용하면 전선들을 쉽게 연결할 수 있고 무엇보다 눈으로 구분하기 쉬워서 유지보수에 유리하다.


    + HC-SR04 초음파 거리센서
        + 움직임 감지 센서가 없기 때문에 차선책으로 초음파 센서를 사용하였다.초음파 센서는 40KHz의 펄스 신호를 출력하여 반사되어 돌아오는 펄스의 시간을 측정하여 거리를 계산한다.이를 활용하여 new_dist, old_dist 두가지로 값을 따로 저장하여 바로 과거 값과 현재 값을 비교하고 이를 절댓값으로 전환하여 약 1cm이상 차이가 발생하면 이를 움직임이라고 인식하며 경고를 전달한다. (내부사용 시 물건의 도난확인 가능, 외부사용 시 접근하는 위험요인 감지 가능)
     
    + 충전 신호
        + 안전, 보안 관리에는 허용된 인원만이 접근할 수 있어야 한다.접근을 허가하는 센서로 카메라를 통한 얼굴 인식등 다양한 도전을 하고 싶었지만. 센서가 없기 때문에 차선책으로 푸쉬 버튼을 이용하여 비밀번호 입력 자판을 만들었다.
	    비밀번호 입력 자판은 빨, 초, 노, 흰 4가지 색상에 버튼으로 이루어져 있다.
        초기 비밀번호는 빨->초->노->초로 설정하였다.
	    비밀번호를 입력 후 흰색 버튼을 누르면 값이 입력되고 값이 맞으면 열린다. 값이 틀리게 되면 잘못된 접근 신호가 쌓이게 된다.(이 잘못된 신호는 값이 맞아 열리면 0으로 초기화 되지만 CSV파일 기억에는 남아있다.)  
  	    최대한 오타를 줄이기 위하여 버튼을 누르면 바로 위에 위치한 버튼과 똑같은 색의 led가 짧게 빛이 나게 되고 이를 통해 확실하게 버튼입력을 확인할 수 있다. (모니터가 없는 상황에서 확실한 입력확인방법으로 가정)
        버튼을 사용하여 문 열림 등 다양하게 사용될 수 있다.(문이 열리면 자동으로 버튼에 눌러졌던 압력이 풀리며 값 전달)  

<br><br><br><br>

+ ## 원격 서버 이용

    + 아마존 웹서비스(AWS)를 이용하여 서버 구축 약 1초 간격으로 서버로 당시의 시간, 문 상태, 움직임감지, 잘못된 비밀번호 입력 등 다양한 센서값이 서버로 즉시 전달되며 CSV파일로 저장된다. 서버에 전달된 값으로 다양하게 값에 대한 경고, 데이터의 시각화 등 다양한 표현을 시도한다.
![]({{site.baseurl}}/images/smart_safe/data.PNG)


<br><br><br><br>

+ ## 하드웨어

![]({{site.baseurl}}/images/smart_safe/sensor.PNG)
<br><br><br><br>

+ ## 주요 개념 정리
    +   라즈베리파이 기본 시스템(모듈) 구현
        GPIO 포트를 통하여 버튼(4개), LED(3개), 초음파센서(1개)등 센서의 입력과 출력 포트를 제어 -> 비밀번호 등 간단 알고리즘 적용하여 보안 및 값의 추출 
 	     
	
	+   FLASK 라즈베리에 접속되어 있는 센서들을 웹 기술을 통해 조작하고, 실시간으로 기기의 상태 값을 받아서 FLASK 응용을 통해 결과를 출력

	+   AWS를 통해 클라우드 컴퓨터를 생성 및 원격서버로 이용 센서 값들을 수신 받고 	이를 서버컴퓨터에 저장한다.

<br><br><br><br>

+ ## 과제 개발 성과

![]({{site.baseurl}}/images/smart_safe/achievement.PNG)
<br><br><br><br>

+ ## 공부하며 알게 된 개발 방법

	+    Pandas
		    판다는 정형 데이터 처리에 특화된 파이썬 라이브러리입니다. 
		    NumPy array와 통합되어 강력한 스프레드시트 처리 기능을 제공하여 쉽고 
		    빠르게 많은 작업들을 처리해줍니다.

	+   Flask-CORS 
		    도메인이 다르기 때문에 CORS를 허용 해야 합니다

	+   Vue.js  
			사용자 인터페이스를 만들기 위한 프로그레시브 프레임워크 입니다. 
		
	+   작동 방식(요약) : CSV파일을 읽어 와서 html파일에서 동작합니다 
            ![]({{site.baseurl}}/images/safe.gif)       

		하늘색 차트가 로그인 실패횟수입니다.
		어두운 파란색 차트가 위에 있을 때는 닫힌 상태 아래로 내려오면 열린 상태입니다.
		주황색 차트는 움직임 감지 센서에서 움직임 감지 포착하면 그래프가 튀어 오릅니다.


	+ 더 공부해서 해결해야할 해결과제
		
	    서버를 항상 켜두기로 실행하면 Pandas라이브라리가 오류가 발생함 오류를 
        해결하기 위해 다양한 검색 및 업데이트 등 보이는 방법은 전부하였지만, 실패 파이썬으로 서버.py 바로 실행하면 잘 동작한다.
        서버에서 서버.py로 바로 실행 시 다른 동작 불가능 
     	※같은 환경설정을 적용한 윈도우에서 서버.py로 바로 실행 후 html파일을 따로 실행시킬 경우 위 그림처럼 정상 작동한다. 
<br><br><br><br>